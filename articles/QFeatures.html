<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quantitative features for mass spectrometry data • QFeatures</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quantitative features for mass spectrometry data">
<meta property="og:description" content="QFeatures">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">QFeatures</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/QFeatures.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Processing.html">Processing quantitative proteomics data with QFeatures</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RforMassSpectrometry/QFeatures/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="QFeatures_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quantitative features for mass spectrometry data</h1>
                        <h4 class="author">Laurent Gatto</h4>
                        
      
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/QFeatures/blob/master/vignettes/QFeatures.Rmd"><code>vignettes/QFeatures.Rmd</code></a></small>
      <div class="hidden name"><code>QFeatures.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>This vignette describes the functionality implemented in the QFeatures package. QFeatures provides infrastructure to manage and process quantitative features for high-throughput mass spectrometry assays, including proteomics and metabolomics.</p>
    </div>
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The <code>QFeatures</code> package provides infrastructure (that is classes and the methods to process and manipulate them) to manage and analyse quantitative features from mass spectrometry experiments. It is based on the <code>MultiAssayExperiment</code> class from the <em><a href="https://bioconductor.org/packages/3.12/MultiAssayExperiment">MultiAssayExperiment</a></em> <span class="citation">(Ramos et al. 2017)</span>. that stores a set of assays. Assays in a <code>QFeatures</code> object have a specific relation, that is depicted in figure @ref(fig:featuresplot): assays in a <code>QFeatures</code> object are the result of the aggregation of quantitative features of other assays. In the case of a quantitative proteomics experiment, these different assays would be PSMs, that are aggregated into peptides, that are themselves aggregated into proteins.</p>
<div class="figure">
<img src="QFeatures_files/figure-html/featuresplot-1.png" alt="Conceptual representation of a `QFeatures` object and the aggregative relation between different assays." width="700"><p class="caption">
Conceptual representation of a <code>QFeatures</code> object and the aggregative relation between different assays.
</p>
</div>
<p>In the following sections, we are going to demonstrate how to create a single-assay <code>QFeatures</code> objects starting from a spreadsheet, how to compute the next assays (peptides and proteins), and how these can be manipulated and explored.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://github.com/RforMassSpectrometry/QFeatures">"QFeatures"</a></span>)
</pre></div>
</div>
<div id="creating-qfeatures-object" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-qfeatures-object" class="anchor"></a>Creating <code>QFeatures</code> object</h1>
<p>While <code>QFeatures</code> objects can be created manually (see <code><a href="../reference/QFeatures.html">?QFeatures</a></code> for details), most users will probably possess quantitative data in a spreadsheet or a dataframe. In such cases, the easiest is to use the <code>readQFeatures</code> function to extract the quantitative data and metadata columns. Below, we load the <code>hlpsms</code> dataframe that contains data for 28 PSMs from the TMT-10plex <em>hyper</em>LOPIT spatial proteomics experiment from <span class="citation">(Christoforou et al. 2016)</span>. The <code>ecol</code> argument specifies that columns 1 to 10 contain quantitation data, and that the assay should be named <code>psms</code> in the returned <code>QFeatures</code> object, to reflect the nature of the data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="kw">hlpsms</span>)
<span class="kw">hl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readQFeatures.html">readQFeatures</a></span>(<span class="kw">hlpsms</span>, ecol = <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, name = <span class="st">"psms"</span>)
<span class="kw">hl</span>
</pre></div>
<pre><code>## An instance of class QFeatures containing 1 assays:
##  [1] psms: SummarizedExperiment with 3010 rows and 10 columns</code></pre>
<p>Below, we see that we can extract an assay using its index or its name. The individual assays are stored as <em>SummerizedExperiment</em> object and further access its quantitative data and metadata using the <code>assay</code> and <code>rowData</code> functions</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">hl</span>[[<span class="fl">1</span>]]
</pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 3010 10 
## metadata(0):
## assays(1): ''
## rownames(3010): 1 2 ... 3009 3010
## rowData names(18): Sequence ProteinDescriptions ... RTmin markers
## colnames(10): X126 X127C ... X130N X131
## colData names(0):</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">hl</span>[[<span class="st">"psms"</span>]]
</pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 3010 10 
## metadata(0):
## assays(1): ''
## rownames(3010): 1 2 ... 3009 3010
## rowData names(18): Sequence ProteinDescriptions ... RTmin markers
## colnames(10): X126 X127C ... X130N X131
## colData names(0):</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu">assay</span>(<span class="kw">hl</span>[[<span class="st">"psms"</span>]]))
</pre></div>
<pre><code>##         X126      X127C       X127N      X128C       X128N      X129C
## 1 0.12283431 0.08045915 0.070804055 0.09386901 0.051815695 0.13034383
## 2 0.35268185 0.14162381 0.167523880 0.07843497 0.071087436 0.03214548
## 3 0.01546089 0.16142297 0.086938133 0.23120844 0.114664348 0.09610188
## 4 0.04702854 0.09288723 0.102012167 0.11125409 0.067969116 0.14155358
## 5 0.01044693 0.15866147 0.167315736 0.21017494 0.147946673 0.07088253
## 6 0.04955362 0.01215244 0.002477681 0.01297833 0.002988949 0.06253195
##        X129N       X130C      X130N       X131
## 1 0.17540095 0.040068658 0.11478839 0.11961594
## 2 0.06686260 0.031961793 0.02810434 0.02957384
## 3 0.15977819 0.010127118 0.08059400 0.04370403
## 4 0.18015910 0.035329902 0.12166589 0.10014038
## 5 0.17555789 0.007088253 0.02884754 0.02307803
## 6 0.01726511 0.172651119 0.37007905 0.29732174</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu">rowData</span>(<span class="kw">hl</span>[[<span class="st">"psms"</span>]]))
</pre></div>
<pre><code>## DataFrame with 6 rows and 18 columns
##      Sequence ProteinDescriptions NbProteins ProteinGroupAccessions
##   &lt;character&gt;         &lt;character&gt;  &lt;integer&gt;            &lt;character&gt;
## 1     SQGEIDk       Tetratrico...          1                 Q8BYY4
## 2     YEAQGDk       Vacuolar p...          1                 P46467
## 3     TTScDTk       C-type man...          1                 Q64449
## 4     aEELESR       Liprin-alp...          1                 P60469
## 5     aQEEAIk       Isoform 2 ...          2               P13597-2
## 6    dGAVDGcR       Structural...          1                 Q6P5D8
##   Modifications    qValue       PEP  IonScore NbMissedCleavages
##     &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;integer&gt;         &lt;integer&gt;
## 1 K7(TMT6ple...     0.008   0.11800        27                 0
## 2 K7(TMT6ple...     0.001   0.01070        27                 0
## 3 C4(Carbami...     0.008   0.11800        11                 0
## 4 N-Term(TMT...     0.002   0.04450        24                 0
## 5 N-Term(Car...     0.001   0.00850        36                 0
## 6 N-Term(TMT...     0.000   0.00322        26                 0
##   IsolationInterference IonInjectTimems Intensity    Charge      mzDa      MHDa
##               &lt;integer&gt;       &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt; &lt;numeric&gt; &lt;numeric&gt;
## 1                     0              70    335000         2   503.274   1005.54
## 2                     0              70    926000         2   520.267   1039.53
## 3                     0              70    159000         2   521.258   1041.51
## 4                     0              70    232000         2   531.785   1062.56
## 5                     0              70    212000         2   537.804   1074.60
## 6                     0              70    865000         2   539.761   1078.51
##   DeltaMassPPM     RTmin       markers
##      &lt;numeric&gt; &lt;numeric&gt;   &lt;character&gt;
## 1        -0.38     24.02       unknown
## 2         0.61     18.85       unknown
## 3         1.11     10.17       unknown
## 4         0.35     29.18       unknown
## 5         1.70     25.56 Plasma mem...
## 6        -0.67     21.27 Nucleus - ...</code></pre>
<p>For further details on how to manipulate such objects, refer to the <em><a href="https://bioconductor.org/packages/3.12/MultiAssayExperiment">MultiAssayExperiment</a></em> <span class="citation">(Ramos et al. 2017)</span> and <em><a href="https://bioconductor.org/packages/3.12/SummerizedExperiment">SummerizedExperiment</a></em> <span class="citation">(Morgan et al. 2019)</span> packages.</p>
<p>As illustrated in figure @ref(fig:featuresplot), an central characteristic of <code>QFeatures</code> objects is the aggregative relation between their assays. This can be obtained with the <code>aggregateFeatures</code> function that will aggregate quantitative features from one assay into a new one. In the next code chunk, we aggregate PSM-level data into peptide by grouping all PSMs that were matched the same peptide sequence. Below, the aggregation function is set, as an example, to the mean. The new assay is named <em>peptides</em>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">hl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregateFeatures.html">aggregateFeatures</a></span>(<span class="kw">hl</span>, <span class="st">"psms"</span>, <span class="st">"Sequence"</span>, name = <span class="st">"peptides"</span>, fun = <span class="kw">colMeans</span>)
</pre></div>
<pre><code>## Your row data contain missing values. Please read the relevant
## section(s) in the aggregateFeatures manual page regarding the effects
## of missing values on data aggregation.</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">hl</span>
</pre></div>
<pre><code>## An instance of class QFeatures containing 2 assays:
##  [1] psms: SummarizedExperiment with 3010 rows and 10 columns 
##  [2] peptides: SummarizedExperiment with 2923 rows and 10 columns</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">hl</span>[[<span class="st">"peptides"</span>]]
</pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 2923 10 
## metadata(0):
## assays(2): assay aggcounts
## rownames(2923): aAADADVSLHNFSAR aAADPSEk ... yYSFFDLNPk YYSIASSSk
## rowData names(7): Sequence ProteinDescriptions ... markers .n
## colnames(10): X126 X127C ... X130N X131
## colData names(0):</code></pre>
<p>Below, we repeat the aggregation operation by grouping peptides into proteins as defined by the <em>ProteinGroupAccessions</em> variable.</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">hl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregateFeatures.html">aggregateFeatures</a></span>(<span class="kw">hl</span>, <span class="st">"peptides"</span>, <span class="st">"ProteinGroupAccessions"</span>, name = <span class="st">"proteins"</span>, fun = <span class="kw">colMeans</span>)
<span class="kw">hl</span>
</pre></div>
<pre><code>## An instance of class QFeatures containing 3 assays:
##  [1] psms: SummarizedExperiment with 3010 rows and 10 columns 
##  [2] peptides: SummarizedExperiment with 2923 rows and 10 columns 
##  [3] proteins: SummarizedExperiment with 1596 rows and 10 columns</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">hl</span>[[<span class="st">"proteins"</span>]]
</pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 1596 10 
## metadata(0):
## assays(2): assay aggcounts
## rownames(1596): A2A432 A2A6Q5-3 ... Q9Z2Z9 Q9Z315
## rowData names(3): ProteinGroupAccessions markers .n
## colnames(10): X126 X127C ... X130N X131
## colData names(0):</code></pre>
<p>The sample assayed in a <code>QFeatures</code> object can be documented in the <code>colData</code> slot. The <code>hl</code> data doens’t currently possess any sample metadata. These can be addedd as a new <code>DataFrame</code> with matching names (i.e. the <code>DataFrame</code> rownames must be identical assay’s colnames) or can be added one variable at at time, as shown below.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="fu">colData</span>(<span class="kw">hl</span>)
</pre></div>
<pre><code>## DataFrame with 10 rows and 0 columns</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="kw">hl</span><span class="op">$</span><span class="kw">tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"126"</span>, <span class="st">"127N"</span>, <span class="st">"127C"</span>, <span class="st">"128N"</span>, <span class="st">"128C"</span>, <span class="st">"129N"</span>, <span class="st">"129C"</span>,
            <span class="st">"130N"</span>, <span class="st">"130C"</span>, <span class="st">"131"</span>)
<span class="fu">colData</span>(<span class="kw">hl</span>)
</pre></div>
<pre><code>## DataFrame with 10 rows and 1 column
##               tag
##       &lt;character&gt;
## X126          126
## X127C        127N
## X127N        127C
## X128C        128N
## X128N        128C
## X129C        129N
## X129N        129C
## X130C        130N
## X130N        130C
## X131          131</code></pre>
</div>
<div id="subsetting" class="section level1">
<h1 class="hasAnchor">
<a href="#subsetting" class="anchor"></a>Subsetting</h1>
<p>One particularity of the <code>QFeatures</code> infrastructure is that the features of the constitutive assays are linked through an aggregative relation. This relation is recorded when creating new assays with <code>aggregateFeatures</code> and is exploited when subsetting <code>QFeature</code> by their feature names.</p>
<p>In the example below, we are interested in the Stat3B isoform of the Signal transducer and activator of transcription 3 (STAT3) with accession number P42227-2. This accession number corresponds to a feature name in the <em>proteins</em> assay. But this protein row was computed from 8 peptide rows in the <em>peptides</em> assay, themselves resulting from the aggregation of 8 rows in the <em>psms</em> assay.</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="kw">stat3</span> <span class="op">&lt;-</span> <span class="kw">hl</span>[<span class="st">"P42227-2"</span>, , ]
<span class="kw">stat3</span>
</pre></div>
<pre><code>## An instance of class QFeatures containing 3 assays:
##  [1] psms: SummarizedExperiment with 9 rows and 10 columns 
##  [2] peptides: SummarizedExperiment with 8 rows and 10 columns 
##  [3] proteins: SummarizedExperiment with 1 rows and 10 columns</code></pre>
<p>We can easily visualise this new <em>QFeatures</em> object using <code>ggplot2</code> once converted into a <code>data.frame</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="kw">stat3_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu">longFormat</span>(<span class="kw">stat3</span>))
<span class="kw">stat3_df</span><span class="op">$</span><span class="kw">assay</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="kw">stat3_df</span><span class="op">$</span><span class="kw">assay</span>,
                        levels = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"psms"</span>, <span class="st">"peptides"</span>, <span class="st">"proteins"</span>))

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="http://ggplot2.tidyverse.org">"ggplot2"</a></span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(data = <span class="kw">stat3_df</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">colname</span>,
           y = <span class="kw">value</span>,
           group = <span class="kw">rowname</span>)) <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(<span class="op">~</span> <span class="kw">assay</span>)
</pre></div>
<p><img src="QFeatures_files/figure-html/plotstat3-1.png" width="700"></p>
<p>Below we repeat the same operation for the Signal transducer and activator of transcription 1 (STAT1) and 3 (STAT3) accession numbers, namely P42227-2 and P42225. We obtain a new <code>QFeatures</code> instance containing 2 proteins, 9 peptides and 10 PSMS. From this, we can readily conclude that STAT1 was identified by a single PSM/peptide.</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="kw">stat</span> <span class="op">&lt;-</span> <span class="kw">hl</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"P42227-2"</span>, <span class="st">"P42225"</span>), , ]
<span class="kw">stat</span>
</pre></div>
<pre><code>## An instance of class QFeatures containing 3 assays:
##  [1] psms: SummarizedExperiment with 10 rows and 10 columns 
##  [2] peptides: SummarizedExperiment with 9 rows and 10 columns 
##  [3] proteins: SummarizedExperiment with 2 rows and 10 columns</code></pre>
<p>Below, we visualise the expression profiles for the two proteins.</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="kw">stat_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu">longFormat</span>(<span class="kw">stat</span>))
<span class="kw">stat_df</span><span class="op">$</span><span class="kw">stat3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">stat_df</span><span class="op">$</span><span class="kw">rowname</span> <span class="op">%in%</span> <span class="kw">stat3_df</span><span class="op">$</span><span class="kw">rowname</span>,
                        <span class="st">"STAT3"</span>, <span class="st">"STAT1"</span>)
<span class="kw">stat_df</span><span class="op">$</span><span class="kw">assay</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="kw">stat_df</span><span class="op">$</span><span class="kw">assay</span>,
                        levels = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"psms"</span>, <span class="st">"peptides"</span>, <span class="st">"proteins"</span>))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(data = <span class="kw">stat_df</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">colname</span>,
           y = <span class="kw">value</span>,
           group = <span class="kw">rowname</span>)) <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(<span class="kw">stat3</span> <span class="op">~</span> <span class="kw">assay</span>)
</pre></div>
<p><img src="QFeatures_files/figure-html/plotstat-1.png" width="700"></p>
<p>The subsetting by feature names is also available as a call to the <code>subsetByFeature</code> function, for use with the pipe operator.</p>
<div class="sourceCode" id="cb32"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">magrittr</span>)
<span class="kw">hl</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/subsetByFeature.html">subsetByFeature</a></span>(<span class="st">"P42227-2"</span>)
</pre></div>
<pre><code>## An instance of class QFeatures containing 3 assays:
##  [1] psms: SummarizedExperiment with 9 rows and 10 columns 
##  [2] peptides: SummarizedExperiment with 8 rows and 10 columns 
##  [3] proteins: SummarizedExperiment with 1 rows and 10 columns</code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit">
<span class="kw">hl</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/subsetByFeature.html">subsetByFeature</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"P42227-2"</span>, <span class="st">"P42225"</span>))
</pre></div>
<pre><code>## An instance of class QFeatures containing 3 assays:
##  [1] psms: SummarizedExperiment with 10 rows and 10 columns 
##  [2] peptides: SummarizedExperiment with 9 rows and 10 columns 
##  [3] proteins: SummarizedExperiment with 2 rows and 10 columns</code></pre>
<p>and possibly</p>
<div class="sourceCode" id="cb36"><pre class="downlit">
<span class="kw">hl</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/subsetByFeature.html">subsetByFeature</a></span>(<span class="st">"P42227-2"</span>) <span class="op">%&gt;%</span>
    <span class="fu">longFormat</span>() <span class="op">%&gt;%</span>
    <span class="kw">as.data.frame</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">colname</span>,
               y = <span class="kw">value</span>,
               group = <span class="kw">rowname</span>)) <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(<span class="op">~</span> <span class="kw">assay</span>)
</pre></div>
<p>to reproduce the line plot.</p>
<p>Finally, a simply <code>shiny</code> app allows to explore and visualise the respective assays of a <code>QFeatures</code> object.</p>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="fu"><a href="../reference/display.html">display</a></span>(<span class="kw">stat</span>)
</pre></div>
<div class="figure" style="text-align: center">
<img src="figs/display_hmap.png" alt="`QFeatures` interactive interface: heatmap of the peptide assay data." width="100%"><p class="caption">
<code>QFeatures</code> interactive interface: heatmap of the peptide assay data.
</p>
</div>
<div class="figure" style="text-align: center">
<img src="figs/display_assay.png" alt="`QFeatures` interactive interface: quantitative peptide assay data." width="100%"><p class="caption">
<code>QFeatures</code> interactive interface: quantitative peptide assay data.
</p>
</div>
<div class="figure" style="text-align: center">
<img src="figs/display_rowdata.png" alt="`QFeatures` interactive interface: peptide assay row data" width="100%"><p class="caption">
<code>QFeatures</code> interactive interface: peptide assay row data
</p>
</div>
<p>A dropdown menu in the side bar allows the user to select an assay of interest, which can then be visualised as a heatmap (figure @ref(fig:heatmapdisplay)), as a quantitative table (figure @ref(fig:assaydisplay)) or a row data table (figure @ref(fig:rowdatadisplay)).</p>
</div>
<div id="filtering" class="section level1">
<h1 class="hasAnchor">
<a href="#filtering" class="anchor"></a>Filtering</h1>
<p>QFeatures is assays can also be filtered based on variables in their respective row data slots using the <code>filterFeatures</code> function. The filters can be defined using the formula interface or using <code>AnnotationFilter</code> objects from the <em><a href="https://bioconductor.org/packages/3.12/AnnotationFilter">AnnotationFilter</a></em> package <span class="citation">(Morgan and Rainer 2019)</span>. In addition to the pre-defined filters (such as <code>SymbolFilter</code>, <code>ProteinIdFilter</code>, … that filter on gene symbol, protein identifier, …), this package allows users to define arbitrary character or numeric filters using the <code>VariableFilter</code>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit">
<span class="kw">mito_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/QFeatures-filtering.html">VariableFilter</a></span>(field = <span class="st">"markers"</span>,
                              value = <span class="st">"Mitochondrion"</span>,
                              condition = <span class="st">"=="</span>)
<span class="kw">mito_filter</span>
</pre></div>
<pre><code>## class: CharacterVariableFilter 
## condition: == 
## value: Mitochondrion</code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit">
<span class="kw">qval_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/QFeatures-filtering.html">VariableFilter</a></span>(field = <span class="st">"qValue"</span>,
                              value = <span class="fl">0.001</span>,
                              condition = <span class="st">"&lt;="</span>)
<span class="kw">qval_filter</span>
</pre></div>
<pre><code>## class: NumericVariableFilter 
## condition: &lt;= 
## value: 0.001</code></pre>
<p>These filter can then readily be applied to all assays’ row data slots. The <code>mito_filter</code> will return all PSMs, peptides and proteins that were annotated as localising to the mitochondrion.</p>
<div class="sourceCode" id="cb42"><pre class="downlit">
<span class="fu"><a href="../reference/QFeatures-filtering.html">filterFeatures</a></span>(<span class="kw">hl</span>, <span class="kw">mito_filter</span>)
</pre></div>
<pre><code>## An instance of class QFeatures containing 3 assays:
##  [1] psms: SummarizedExperiment with 167 rows and 10 columns 
##  [2] peptides: SummarizedExperiment with 162 rows and 10 columns 
##  [3] proteins: SummarizedExperiment with 113 rows and 10 columns</code></pre>
<p>The <code>qval_filter</code>, on the other hand, will only return a subset of PSMs, because the <code>qValue</code> variable is only present in the <code>psms</code> assays. The q-values are only relevant to PSMs and that variable was dropped from the other assays.</p>
<div class="sourceCode" id="cb44"><pre class="downlit">
<span class="fu"><a href="../reference/QFeatures-filtering.html">filterFeatures</a></span>(<span class="kw">hl</span>, <span class="kw">qval_filter</span>)
</pre></div>
<pre><code>## harmonizing input:
##   removing 20 sampleMap rows not in names(experiments)</code></pre>
<pre><code>## An instance of class QFeatures containing 1 assays:
##  [1] psms: SummarizedExperiment with 2466 rows and 10 columns</code></pre>
<p>The same filters can be created using the forumla interface:</p>
<div class="sourceCode" id="cb47"><pre class="downlit">
<span class="fu"><a href="../reference/QFeatures-filtering.html">filterFeatures</a></span>(<span class="kw">hl</span>, <span class="op">~</span> <span class="kw">markers</span> <span class="op">==</span> <span class="st">"Mitochondrion"</span>)
</pre></div>
<pre><code>## An instance of class QFeatures containing 3 assays:
##  [1] psms: SummarizedExperiment with 167 rows and 10 columns 
##  [2] peptides: SummarizedExperiment with 162 rows and 10 columns 
##  [3] proteins: SummarizedExperiment with 113 rows and 10 columns</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit">
<span class="fu"><a href="../reference/QFeatures-filtering.html">filterFeatures</a></span>(<span class="kw">hl</span>, <span class="op">~</span> <span class="kw">qValue</span> <span class="op">&lt;=</span> <span class="fl">0.001</span>)
</pre></div>
<pre><code>## harmonizing input:
##   removing 20 sampleMap rows not in names(experiments)</code></pre>
<pre><code>## An instance of class QFeatures containing 1 assays:
##  [1] psms: SummarizedExperiment with 2466 rows and 10 columns</code></pre>
</div>
<div id="session-information" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session information</h1>
<pre><code>## R version 4.0.2 Patched (2020-09-02 r79126)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.1 LTS
## 
## Matrix products: default
## BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-openmp/libopenblasp-r0.3.8.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] parallel  stats4    stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] magrittr_1.5                ggplot2_3.3.2              
##  [3] QFeatures_0.99.3            MultiAssayExperiment_1.15.3
##  [5] SummarizedExperiment_1.19.6 DelayedArray_0.15.7        
##  [7] matrixStats_0.56.0          Matrix_1.2-18              
##  [9] Biobase_2.49.1              GenomicRanges_1.41.6       
## [11] GenomeInfoDb_1.25.11        IRanges_2.23.10            
## [13] S4Vectors_0.27.12           BiocGenerics_0.35.4        
## [15] BiocStyle_2.17.0           
## 
## loaded via a namespace (and not attached):
##  [1] lattice_0.20-41         assertthat_0.2.1        rprojroot_1.3-2        
##  [4] digest_0.6.25           R6_2.4.1                backports_1.1.9        
##  [7] evaluate_0.14           highr_0.8               pillar_1.4.6           
## [10] zlibbioc_1.35.0         rlang_0.4.7             lazyeval_0.2.2         
## [13] rmarkdown_2.3           pkgdown_1.6.0.9000      labeling_0.3           
## [16] desc_1.2.0              stringr_1.4.0           ProtGenerics_1.21.0    
## [19] RCurl_1.98-1.2          munsell_0.5.0           compiler_4.0.2         
## [22] xfun_0.16               pkgconfig_2.0.3         systemfonts_0.3.0      
## [25] htmltools_0.5.0         tidyselect_1.1.0        tibble_3.0.3           
## [28] GenomeInfoDbData_1.2.3  bookdown_0.20           withr_2.2.0            
## [31] crayon_1.3.4            dplyr_1.0.2             MASS_7.3-52            
## [34] bitops_1.0-6            grid_4.0.2              gtable_0.3.0           
## [37] lifecycle_0.2.0         AnnotationFilter_1.13.0 MsCoreUtils_1.1.3      
## [40] scales_1.1.1            stringi_1.4.6           farver_2.0.3           
## [43] XVector_0.29.3          fs_1.5.0                ellipsis_0.3.1         
## [46] ragg_0.3.1              vctrs_0.3.4             generics_0.0.2         
## [49] tools_4.0.2             glue_1.4.2              purrr_0.3.4            
## [52] yaml_2.2.1              colorspace_1.4-1        BiocManager_1.30.10    
## [55] cpp11_0.2.1             memoise_1.1.0           knitr_1.29</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Christoforou:2016">
<p>Christoforou, Andy, Claire M Mulvey, Lisa M Breckels, Aikaterini Geladaki, Tracey Hurrell, Penelope C Hayward, Thomas Naake, et al. 2016. “A Draft Map of the Mouse Pluripotent Stem Cell Spatial Proteome.” <em>Nat Commun</em> 7: 8992. <a href="https://doi.org/10.1038/ncomms9992">https://doi.org/10.1038/ncomms9992</a>.</p>
</div>
<div id="ref-SE">
<p>Morgan, Martin, Valerie Obenchain, Jim Hester, and Hervé Pagès. 2019. <em>SummarizedExperiment: SummarizedExperiment Container</em>.</p>
</div>
<div id="ref-AnnotationFilter">
<p>Morgan, Martin, and Johannes Rainer. 2019. <em>AnnotationFilter: Facilities for Filtering Bioconductor Annotation Resources</em>. <a href="https://github.com/Bioconductor/AnnotationFilter">https://github.com/Bioconductor/AnnotationFilter</a>.</p>
</div>
<div id="ref-Ramos:2017">
<p>Ramos, Marcel, Lucas Schiffer, Angela Re, Rimsha Azhar, Azfar Basunia, Carmen Rodriguez Cabrera, Tiffany Chan, et al. 2017. “Software for the Integration of Multi-Omics Experiments in Bioconductor.” <em>Cancer Research</em> 77(21); e39-42.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Laurent Gatto, Christophe Vanderaa.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
